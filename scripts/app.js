APP.Main=function(){function e(e,n){for(var i=document.querySelectorAll(".story"),r=0;r<i.length;r++)if(i[r].getAttribute("id")==="s-"+e){n.time*=1e3;var l=i[r],s=b(n);l.innerHTML=s,l.addEventListener("click",t.bind(this,n)),l.classList.add("clickable"),y--}0===y&&o()}function t(e){var t=s("sd-"+e.id);if(setTimeout(n.bind(this,e.id),60),!t){e.url&&(e.urlobj=new URL(e.url));var o,r,l,a,d=L(e),c=e.kids,u=C({by:"",text:"Loading comment..."});t=document.createElement("section"),t.setAttribute("id","sd-"+e.id),t.classList.add("story-details"),t.innerHTML=d,document.body.appendChild(t),r=t.querySelector(".js-comments"),l=t.querySelector(".js-header"),a=t.querySelector(".js-content");var m=t.querySelector(".js-close");m.addEventListener("click",i.bind(this,e.id));var y=l.getBoundingClientRect().height;if(a.style.paddingTop=y+"px","undefined"==typeof c)return;for(var p=0;p<c.length;p++)o=document.createElement("aside"),o.setAttribute("id","sdc-"+c[p]),o.classList.add("story-details__comment"),o.innerHTML=u,r.appendChild(o),APP.Data.getStoryComment(c[p],function(e){e.time*=1e3;var t=r.querySelector("#sdc-"+e.id);t.innerHTML=C(e,f)})}}function n(e){function t(){var e=n.getBoundingClientRect();null===i&&(i=e.left),i+=.1*(0-e.left),Math.abs(i)>.5?setTimeout(t,4):i=0,n.style.left=i+"px"}if(!m){m=!0;var n=s("#sd-"+e),i=null;n&&(document.body.classList.add("details-active"),n.style.opacity=1,setTimeout(t,4))}}function i(e){function t(){var e=u.getBoundingClientRect(),o=n.getBoundingClientRect(),r=e.width+100;i+=.1*(r-o.left),Math.abs(i-r)>.5?setTimeout(t,4):(i=r,m=!1),n.style.left=i+"px"}if(m){var n=s("#sd-"+e),i=0;document.body.classList.remove("details-active"),n.style.opacity=0,setTimeout(t,4)}}function o(){for(var e=document.querySelectorAll(".story"),t=0;t<e.length;t++){var n=e[t],i=n.querySelector(".story__score"),o=n.querySelector(".story__title"),r=u.offsetHeight,l=(u.getBoundingClientRect(),i.getBoundingClientRect().top-document.body.getBoundingClientRect().top),s=Math.min(1,1-.05*((l-170)/r)),a=Math.min(1,1-.5*((l-170)/r));i.style.width=40*s+"px",i.style.height=40*s+"px",i.style.lineHeight=40*s+"px",l=i.getBoundingClientRect();var d=100*((l.width-38)/2);i.style.backgroundColor="hsl(42, "+d+"%, 50%)",o.style.opacity=a}}function r(){if(!(y>0)){y=c;for(var t=d+c,n=d;t>n;n++){if(n>=a.length)return;var i=String(a[n]),o=document.createElement("div");o.setAttribute("id","s-"+i),o.classList.add("story"),o.innerHTML=b({title:"...",score:"-",by:"...",time:0}),u.appendChild(o),APP.Data.getStoryById(a[n],e.bind(this,i))}d+=c}}var l=300,s=document.querySelector.bind(document),a=null,d=0,c=100,u=s("main"),m=!1,y=0,f={data:{intl:{locales:"en-US"}}},p=s("#tmpl-story").textContent,g=s("#tmpl-story-details").textContent,h=s("#tmpl-story-details-comment").textContent;if("undefined"!=typeof HandlebarsIntl)HandlebarsIntl.registerWith(Handlebars);else{var v=/, {{ formatRelative time }}/;p=p.replace(v,""),g=g.replace(v,""),h=h.replace(v,"")}var b=Handlebars.compile(p),L=Handlebars.compile(g),C=Handlebars.compile(h);u.addEventListener("touchstart",function(e){Math.random()>.97&&e.preventDefault()}),u.addEventListener("scroll",function(){var e=s("header"),t=e.querySelector(".header__title-wrapper"),n=Math.min(70,u.scrollTop),i="scale("+(1-n/300)+")";o(),e.style.height=156-n+"px",t.style.webkitTransform=i,t.style.transform=i,u.scrollTop>70?document.body.classList.add("raised"):document.body.classList.remove("raised");var a=u.scrollHeight-u.offsetHeight-l;u.scrollTop>a&&r()}),APP.Data.getTopStories(function(e){a=e,r(),u.classList.remove("loading")})}();
